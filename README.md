# 📷 PhotoProject

> **"기능 구현을 넘어, 대규모 트래픽과 동시성 환경에서도 무너지지 않는 백엔드 설계를 지향합니다."**

---

## 0. 프로젝트 개요

### 0-1. 프로젝트 목적
PhotoProject는 Spring Boot 기반의 REST API 포트폴리오입니다.  
기본적인 기능 구현을 전제로,<br>
실제 운영 환경에서 문제가 될 수 있는 성능 병목, 동시성 이슈, 데이터 정합성 문제를<br>
설계 단계에서부터 분석하고 개선하는 데 목적을 두었습니다.

이를 통해 본 프로젝트는,<br>
트래픽 증가와 동시 요청 상황에서도 안정성을 유지할 수 있는<br>
백엔드 구조를 설계하는 것을 핵심 목표로 합니다.


### 0-2. README 작성 의도
본 README는 구현된 기능을 나열하기 위한 목적이 아닌,  
개발 과정에서 드러난 운영 관점의 문제를 어떻게 식별하고,  
어떤 판단을 통해 개선했는지를 설명하기 위해 작성되었습니다.  

각 개선 항목은 문제의 성격과 영향 범위를 먼저 정의한 뒤,  
실제 재현 조건을 기준으로 분석하고,  
개선 적용 후에는 로그, 쿼리 실행 수, 응답 시간 등의 지표를 통해  
개선 전·후의 차이를 확인할 수 있도록 구성되어 있습니다.  


### 0-3. 핵심 역량 및 기술 요약
- **Backend**: Java 21, Spring Boot 기반 REST API 설계
- **Security**: JWT를 활용한 Stateless 인증·인가 구조
- **Performance**: N+1 문제 및 조회 경로의 비효율성을 중심으로 한 성능 개선
- **Reliability**: 동시성 상황에서의 Race Condition 및 데이터 정합성 이슈 분석


---

## 1. 주요 개선 및 트러블슈팅 (Highlights)
본 섹션에서는 PhotoProject 개발 과정에서 운영 환경을 기준으로 확인된 주요 문제와  
이에 대한 개선 방향 및 검증 결과를 요약합니다.

각 항목은 이후 섹션에서  
문제 정의 → 재현 조건 → 개선 접근 → 검증 결과의 흐름으로  
상세히 다루고 있습니다.

| 주요 이슈                              | 개선 방향 | 검증 기준 |
|------------------------------------| --- | --- |
| 게시글 목록 조회 시 N+1 문제 <br>(Case 4-1)  | 목록 조회와 상세 조회 목적 분리 및 조회 구조 재설계 | 쿼리 실행 수 고정 여부, 응답 시간 비교 |
| 동시성으로 인한 데이터 정합성 붕괴 가능성 <br>(Case 4-2) | DB UNIQUE 제약 기반 중복 차단 및 DB Source of Truth 전략 적용 | 동시 요청 후 중복 row 미발생 및 최종 상태 수렴 여부 |
| 인증·인가 상태코드 정책 불일치 <br>(Case 4-3)       | 인증(401)·인가(403) 실패 기준을 정책적으로 정의하고 상태코드 수렴 | 실패 조건별 상태코드 일관성 |



---

## 2. 기술 스택 (Tech Stack)

### Backend / Framework
- Java 21
- Spring Boot
- Spring Data JPA
- Spring Transaction

### ORM / Persistence
- JPA
- JPQL
- Native Query
- Fetch Join
- Pageable / PageRequest

### Database
- MySQL
- DB UNIQUE INDEX

### Security
- Spring Security
- JWT
- AccessDeniedException

### Build & Test
- Gradle
- Postman

---

## 3. 프로젝트 구조 (Architecture)

PhotoProject는 도메인(User / Post / Comment) 단위로 기능을 분리하고,  
각 도메인 내부에서 Controller / Service / Repository / DTO / Entity 계층을 분리하여  
책임을 명확히 구분하는 구조를 사용합니다.

인증·인가, 공통 응답, 예외 처리 등 전역 관심사는 `global` 영역으로 분리하여  
비즈니스 로직과의 결합도를 낮추는 것을 목표로 구성했습니다.

이와 같은 구조는 기능 추가나 요구사항 변경이 발생하더라도  
영향 범위를 국소화하고, 구조 전반의 안정성을 유지하는 데 목적이 있습니다.

또한 인증·인가, 공통 응답, 예외 처리와 같은 전역 관심사를  
비즈니스 도메인과 분리된 영역으로 구성하여,  
각 도메인의 서비스 로직이 본래의 책임에만 집중할 수 있도록 설계했습니다.

이를 통해 코드 전반의 응집도를 높이고 결합도를 낮추는 한편,  
문제 발생 시 원인 추적과 수정이 용이한 구조를 지향했습니다.

---

## 4. 주요 개선 사례 (Case Study)

본 섹션에서는 PhotoProject 개발 과정에서  
운영 환경을 기준으로 실제 문제가 될 수 있었던 이슈들을 사례별로 정리했습니다.

각 사례는 단순한 개선 결과 나열이 아니라,  
문제 인식 → 재현 조건 설정 → 개선 적용 → 재검증의 흐름을 따라  
개선 전·후의 차이를 확인할 수 있도록 구성되어 있습니다.

각 Case의 상세한 검증 과정과 근거 자료는  
하단에 연결된 개별 문서를 통해 확인하실 수 있습니다.

---

### 4-1. 게시글 조회 성능 개선 (N+1 문제)

#### 문제 상황
- 게시글 **목록 조회 시** 연관 엔티티 접근으로 인해  
  조회 대상 수에 비례하여 추가 쿼리가 반복 실행되는 현상 확인

#### 개선 접근
- 목록 조회와 상세 조회의 목적을 분리하여 조회 경로를 재구성하고,  
  목록 조회에 필요한 데이터만 조회하도록 쿼리 구조를 조정

#### 검증 결과
- 목록 조회 시 실행되는 쿼리 수가 일정하게 유지되는 것을 확인  
- 개선 전·후 응답 시간 비교를 통해 성능 개선 효과를 검증  

👉 **[상세 분석 문서 보기](demo/docs/4-1case-n-plus-one.md)**

---

### 4-2. 좋아요 기능 동시성 문제 개선

#### 문제 상황
- 다중 요청 환경에서 동일 사용자에 의한 좋아요가 중복 저장될 수 있는 위험 확인  
- 이로 인하여 좋아요 수 및 상태가 비결정적으로 변할 가능성 존재

#### 개선 접근
- (post_id, user_id) 기준의 DB UNIQUE 제약을 적용하여 중복 저장을 원천적으로 차단
- 충돌 발생 가능성을 전제로, DB를 최종 기준(Source of Truth)으로 두고 재조회 방식으로 최종 상태를 확정

#### 검증 결과
- 동시 요청 상황에서 중복 데이터 미발생 확인
- 요청 순서와 관계없이 최종 좋아요 상태가 일관되게 유지됨을 검증

👉 **[상세 분석 문서 보기](demo/docs/4-2case-concurrency-like.md)**


---

### 4-3. 인증·인가 예외 처리 흐름 개선

#### 문제 상황
- 인증 및 인가 실패 상황에서 동일한 조건임에도  
  API별로 서로 다른 상태 코드가 반환되는 문제 확인  
- 이로 인해 실패 원인을 명확히 구분하기 어려움

#### 개선 접근
- 인증 실패와 인가 실패를 구분하여  
  각각 401 / 403 상태 코드로 응답 정책을 명확히 정의  
- 인가 실패 상황은 Security 예외를 통해 일관되게 처리하도록 구성  

#### 검증 결과
- 인증·인가 실패 시 상태 코드와 응답 의미가 일관되게 반환됨을 확인  
- 실패 원인에 따른 응답 구분이 명확해짐  

👉 **[상세 분석 문서 보기](demo/docs/4-3case-Authentication&Authorization.md)**

---

## 5. Appendix

본 섹션은 Case Study로 다루지는 않았지만,  
프로젝트 운영 관점에서 추가로 관찰한 실험 및 참고 자료를 정리합니다.

- 조회 데이터 증가 상황에서의 페이징 동작 확인:  
  👉 [페이징 처리 부록 문서](demo/docs/5-1appendix-pagination.md)