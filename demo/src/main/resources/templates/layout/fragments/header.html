<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<header th:fragment="header" class="app-header">
    <div class="app-header__inner">
        <a class="app-logo" th:href="@{/}">PhotoProject</a>

        <nav class="app-nav">
            <a class="app-nav__link" th:href="@{/}">Home |</a>
            <a class="app-nav__link" th:href="@{/ui/demo/posts/write}">Write |</a>

            <!-- 로그인 상태 분기: 표준 HttpServletRequest 기반 -->
            <th:block sec:authorize="isAnonymous()"> <!--비로그인-->
                <a class="app-nav__link" th:href="@{/ui/auth/login}">Login </a>
                <span class="auth-badge auth-badge--guest">
                    인증 필요
                </span>
            </th:block>

            <th:block sec:authorize="isAuthenticated()"> <!--로그인 상태-->
                <span class="app-nav__text">
                      반갑습니다, <span sec:authentication="name"></span>님!
                </span>
                <span class="auth-badge auth-badge--jwt">
                    JWT 인증됨
                </span>
                <button type="button" onclick="logout()">Logout</button>
            </th:block>
        </nav>
    </div>

    <!-- JWT 로그아웃 스크립트 -->
    <script>
        function logout() {
            fetch("/api/auth/logout", {
                method: "POST",
                credentials: "include"
            }).then(() => location.reload());
        }
    </script>
</header>

</html>