<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"> <!-- UTF-8 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- IE 호환 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 반응형 -->
    <title>게시글 상세 | PhotoProject</title> <!-- 탭 제목 -->

    <link rel="stylesheet" th:href="@{/css/main.css}"> <!-- 공통 CSS -->
</head>

<body>
<!-- 공통 헤더 -->
<div th:replace="~{layout/fragments/header :: header}"></div>

<main class="container">
    <section class="card">

        <div style="display:flex; gap:8px; justify-content:flex-end;">
            <a class="btn btn-ghost" th:href="@{/ui/posts}">목록</a>

            <!-- 수정 화면 이동 -->
            <th:block th:if="${viewerId != null and post.authorId == viewerId}">
                <a class="btn btn-ghost" th:href="@{/ui/posts/{id}/edit(id=${post.id})}">수정</a>

                <!-- 삭제는 UI만(동작은 다음 단계에서) -->
                <button class="btn btn-danger" type="button" disabled>삭제</button>
            </th:block>
        </div>


        <hr class="mt-3" style="border:none; border-top:1px solid #eee;">

        <!-- 게시글 본문 영역 -->
        <div class="mt-3">

            <p class="muted" style="margin:0;">
                게시글 번호:
                <strong th:text="${post.id}">0</strong>
            </p>

            <h2 class="mt-2" style="margin-bottom:8px;" th:text="${post.title}">
                제목
            </h2>

            <div class="muted" style="display:flex; gap:12px; flex-wrap:wrap;">
                <span>
                    작성자:
                    <strong th:text="${post.authorName}">작성자</strong>
                </span>
                <span>
                    작성일:
                     <strong th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-12-17 12:00</strong>
                </span>
                <span>
                    좋아요:
                <strong th:text="${post.likeCount}">0</strong>
                </span>
                <span>
                    조회:
                <strong th:text="${post.views}">0</strong>
                </span>
            </div>

            <div class="mt-3" style="white-space:pre-wrap; line-height:1.6;" th:text="${post.content}">
                내용
            </div>
        </div>

        <hr class="mt-4" style="border:none; border-top:1px solid #eee;">

        <!-- 댓글 영역(자리만 먼저) -->
        <div class="mt-3">
            <h3 style="margin-bottom:10px;">댓글</h3>

            <div class="mt-2">
                <!-- PostDetailResponseDto에 latestComments 있다면 출력 (없으면 이 블록은 비어있어도 정상) -->
                <div th:if="${!#lists.isEmpty(post.latestComments)}">
                    <div th:each="c : ${post.latestComments}" class="card" style="padding:12px; margin-bottom:10px;">
                        <div class="muted" style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
                            <span th:text="${c.authorName}">작성자</span>
                            <span th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-12-17 12:00</span>
                        </div>
                        <div class="mt-2" style="white-space:pre-wrap;" th:text="${c.content}">댓글 내용</div>
                    </div>
                </div>
            </div>
            <div class="mt-3" th:if="${#request.userPrincipal != null}">
                <form th:action="@{/ui/posts/{id}/comments(id=${post.id})}"
                      method="post">

                    <textarea name="content" class="input" rows="3" placeholder="댓글을 입력하세요" required
                              style="width:100%; resize:vertical;"></textarea>

                    <div style="text-align:right; margin-top:8px;">
                        <button type="submit" class="btn btn-primary">댓글 작성</button>
                    </div>
                </form>
            </div>

            <!-- 비로그인 사용자 안내 -->
            <div class="mt-3" th:if="${#request.userPrincipal == null}">
                <p class="muted">
                    댓글을 작성하려면
                    <a th:href="@{/ui/auth/login}">로그인</a>
                    해주세요.
                </p>
            </div>
        </div>

    </section>
</main>
</body>
</html>